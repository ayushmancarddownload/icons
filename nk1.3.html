<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poster Studio Pro | Creative Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,700&family=Bebas+Neue&family=Pacifico&family=Outfit:wght@300;400;700&family=Zeyada&family=Noto+Sans+Devanagari:wght@400;700&family=Montserrat:wght@800&family=Dancing+Script:wght@700&family=Space+Grotesk:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --surface: #ffffff;
            --background: #f8fafc;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a; /* Dark background for focus */
            color: #f8fafc;
            user-select: none;
            overflow: hidden;
        }

        /* Gallery Grid */
        .masonry-grid {
            columns: 2;
            column-gap: 1rem;
            padding: 1rem;
        }
        @media (min-width: 768px) { .masonry-grid { columns: 3; } }
        @media (min-width: 1024px) { .masonry-grid { columns: 5; } }

        .masonry-item {
            break-inside: avoid;
            margin-bottom: 1rem;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .masonry-item:hover { transform: scale(1.02); }

        /* Shapes */
        .shape-hexagon { clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .shape-squircle { border-radius: 25% 25% 25% 25% / 25% 25% 25% 25%; }

        /* Draggable Elements */
        .draggable-element {
            cursor: move;
            position: absolute;
            touch-action: none;
            padding: 4px 8px;
            border: 2px solid transparent;
            border-radius: 4px;
            white-space: pre-wrap;
            max-width: 90%;
            z-index: 25;
        }
        .draggable-element.selected {
            border: 2px dashed rgba(255,255,255,0.8);
            background: rgba(0,0,0,0.3);
        }

        /* Animations */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }

        /* Custom Scrollbar for tools */
        .custom-scroll::-webkit-scrollbar { height: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }

        #msgBox {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: none;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <div id="msgBox" class="bg-indigo-600 text-white px-6 py-2 rounded-full shadow-2xl font-bold text-xs"></div>

    <!-- Main Navigation (Gallery View) -->
    <nav id="galleryNav" class="bg-white/10 backdrop-blur-md border-b border-white/10 px-4 h-16 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-bolt text-white text-sm"></i>
            </div>
            <span class="font-bold tracking-tight text-white uppercase text-sm">Poster Studio</span>
        </div>
        <button onclick="toggleSetupModal(true)" class="bg-white/10 hover:bg-white/20 p-2 rounded-full border border-white/10 transition">
            <img id="navPic" src="" class="w-8 h-8 rounded-full">
        </button>
    </nav>

    <!-- Gallery Feed -->
    <main id="gallerySection" class="flex-1 overflow-y-auto">
        <div id="masonryContainer" class="masonry-grid max-w-7xl mx-auto"></div>
        <div id="loader" class="flex flex-col items-center py-10 opacity-0 transition-opacity">
            <div class="w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
    </main>

    <!-- Editor Mode (Full Screen) -->
    <div id="editorModal" class="fixed inset-0 z-50 bg-slate-900 flex flex-col hidden overflow-hidden">
        <!-- Editor Header (Share/Save moved here) -->
        <header class="h-16 border-b border-white/10 flex items-center justify-between px-4 bg-slate-900 shrink-0">
            <button onclick="closeEditor()" class="text-white/60 hover:text-white p-2">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            
            <div class="flex items-center gap-3">
                <button onclick="sharePoster()" class="bg-white/5 hover:bg-white/10 text-white p-2.5 px-4 rounded-xl border border-white/10 text-xs font-bold flex items-center gap-2 transition">
                    <i class="fas fa-share-nodes"></i> Share
                </button>
                <div class="h-6 w-px bg-white/10 mx-1"></div>
                <button onclick="downloadPoster(2)" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2.5 px-4 rounded-xl text-xs font-bold flex items-center gap-2 transition">
                    <i class="fas fa-download"></i> SD
                </button>
                <button onclick="downloadPoster(5)" class="bg-amber-500 hover:bg-amber-600 text-slate-900 p-2.5 px-4 rounded-xl text-xs font-bold flex items-center gap-2 transition">
                    <i class="fas fa-crown"></i> HD
                </button>
            </div>
        </header>

        <!-- Main Workspace (Full Size Image) -->
        <div class="flex-1 relative flex flex-col items-center justify-center p-4 md:p-12 overflow-hidden" onclick="deselectAll()">
            <div id="captureArea" class="relative w-full max-w-[380px] aspect-[4/5] bg-white shadow-[0_0_100px_rgba(0,0,0,0.5)] rounded-3xl overflow-hidden ring-1 ring-white/20" onclick="event.stopPropagation()">
                <img id="canvasMainImage" src="" class="w-full h-full object-cover pointer-events-none" crossorigin="anonymous">
                <div id="dragContainer" class="absolute inset-0 z-20"></div>
                
                <div id="canvasProfileOverlay" class="absolute bottom-0 left-0 right-0 z-30 p-6 flex profile-overlay-gradient backdrop-blur-[2px]">
                    <div id="canvasAvatarContainer" class="relative">
                        <img id="canvasAvatar" src="" class="w-16 h-16 object-cover border-2 border-white/50 shadow-lg">
                        <div class="absolute -bottom-1 -right-1 bg-indigo-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-[8px] border-2 border-white">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                    <div class="flex-1 pb-1 ml-4">
                        <h4 id="canvasName" class="text-white font-bold text-lg leading-tight"></h4>
                        <p id="canvasBio" class="text-white/80 text-xs"></p>
                    </div>
                    <div class="text-right pb-1 opacity-40">
                        <span id="domainTag" class="text-[9px] text-white font-bold tracking-tighter">STUDIO</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tool Panels (Bottom Overlays) -->
        <div id="activeToolPanel" class="bg-slate-800 border-t border-white/10 animate-slide-up p-4 hidden shrink-0">
            <!-- Text Panel -->
            <div id="panelText" class="tool-panel hidden space-y-4">
                <div class="flex gap-2">
                    <input type="text" id="textInput" placeholder="Naya text likhein..." class="flex-1 px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:border-indigo-500">
                    <button onclick="addNewText()" class="bg-indigo-600 text-white px-6 rounded-xl font-bold">Add</button>
                </div>
                <div id="textEditPanel" class="hidden flex flex-wrap gap-4 items-center bg-white/5 p-3 rounded-2xl border border-white/10">
                    <select id="fontSelect" onchange="updateTextStyling()" class="bg-slate-900 text-white text-xs p-2 rounded-lg outline-none flex-1">
                        <option value="'Outfit', sans-serif">Modern Sans</option>
                        <option value="'Noto Sans Devanagari', sans-serif">Hindi</option>
                        <option value="'Pacifico', cursive">Style</option>
                        <option value="'Montserrat', sans-serif">Bold</option>
                    </select>
                    <input type="range" id="sizeRange" min="12" max="100" oninput="updateTextStyling()" class="flex-1 accent-indigo-500">
                    <input type="color" id="colorPicker" oninput="updateTextStyling()" class="w-8 h-8 rounded-full border-none bg-transparent cursor-pointer">
                    <button onclick="deleteSelectedText()" class="text-rose-500 p-2"><i class="fas fa-trash"></i></button>
                </div>
            </div>

            <!-- Layout Panel -->
            <div id="panelLayout" class="tool-panel hidden flex justify-around p-2">
                <button onclick="setTheme('left')" class="flex flex-col items-center gap-2 text-white/60 hover:text-white">
                    <i class="fas fa-align-left text-xl"></i><span class="text-[10px]">Left</span>
                </button>
                <button onclick="setTheme('center')" class="flex flex-col items-center gap-2 text-white/60 hover:text-white">
                    <i class="fas fa-align-center text-xl"></i><span class="text-[10px]">Center</span>
                </button>
                <button onclick="setTheme('right')" class="flex flex-col items-center gap-2 text-white/60 hover:text-white">
                    <i class="fas fa-align-right text-xl"></i><span class="text-[10px]">Right</span>
                </button>
            </div>

            <!-- Avatar Panel -->
            <div id="panelAvatar" class="tool-panel hidden flex justify-around p-2">
                <button onclick="setShape('rounded-full')" class="w-10 h-10 rounded-full border border-white/20"></button>
                <button onclick="setShape('rounded-2xl')" class="w-10 h-10 rounded-2xl border border-white/20"></button>
                <button onclick="setShape('shape-squircle')" class="w-10 h-10 shape-squircle border border-white/20"></button>
                <button onclick="setShape('shape-hexagon')" class="w-10 h-10 shape-hexagon border border-white/20"></button>
            </div>

            <!-- Styles Panel -->
            <div id="panelStyles" class="tool-panel hidden overflow-x-auto whitespace-nowrap custom-scroll py-2">
                <div id="bgSelectors" class="flex gap-3 px-2"></div>
            </div>
        </div>

        <!-- Bottom Menu Bar -->
        <nav class="h-20 bg-slate-900 border-t border-white/10 flex items-center justify-around shrink-0 pb-2">
            <button onclick="showPanel('Text')" class="tool-btn flex flex-col items-center gap-1 text-white/40">
                <i class="fas fa-font text-lg"></i><span class="text-[10px] uppercase font-bold">Text</span>
            </button>
            <button onclick="showPanel('Layout')" class="tool-btn flex flex-col items-center gap-1 text-white/40">
                <i class="fas fa-layer-group text-lg"></i><span class="text-[10px] uppercase font-bold">Layout</span>
            </button>
            <button onclick="showPanel('Avatar')" class="tool-btn flex flex-col items-center gap-1 text-white/40">
                <i class="fas fa-user-circle text-lg"></i><span class="text-[10px] uppercase font-bold">Avatar</span>
            </button>
            <button onclick="showPanel('Styles')" class="tool-btn flex flex-col items-center gap-1 text-white/40">
                <i class="fas fa-palette text-lg"></i><span class="text-[10px] uppercase font-bold">Styles</span>
            </button>
        </nav>
    </div>

    <!-- Setup Modal (Code Same) -->
    <div id="setupModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm hidden">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full mx-4 shadow-2xl animate-fade-in text-center text-slate-900">
            <div class="mb-6">
                <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-edit text-indigo-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold">Welcome Studio</h2>
            </div>
            <div class="space-y-4 mb-8">
                <div class="relative w-24 h-24 mx-auto mb-4">
                    <img id="setupPreview" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full rounded-full object-cover border-4 border-indigo-50">
                    <label class="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full cursor-pointer shadow-lg"><i class="fas fa-plus text-xs"></i><input type="file" id="setupFile" class="hidden" accept="image/*"></label>
                </div>
                <input type="text" id="setupName" placeholder="Aapka Naam" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none">
                <input type="text" id="setupBio" placeholder="Profession" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none">
            </div>
            <button onclick="saveInitialSetup()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg">Shuru Karein</button>
        </div>
    </div>

    <script>
        let currentUser = { name: "Creative Mind", bio: "Designer", pic: "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" };
        let selectedElement = null;

        const premiumGradients = [
            { name: "Night", style: "linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.2), transparent)" },
            { name: "Ocean", style: "linear-gradient(to top, rgba(30,58,138,0.9), rgba(30,58,138,0.1), transparent)" },
            { name: "Mesh", style: "radial-gradient(at bottom right, rgba(99,102,241,0.8), rgba(0,0,0,0.9))" },
            { name: "Soft", style: "rgba(0,0,0,0.5)" },
            { name: "Sunset", style: "radial-gradient(at bottom left, rgba(244,63,94,0.7), rgba(0,0,0,0.8))" }
        ];

        const demoImages = [
            "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=600",
            "https://images.unsplash.com/photo-1529139513402-e209979821ed?q=80&w=600",
            "https://images.unsplash.com/photo-1539109132314-34a77ad70327?q=80&w=600",
            "https://images.unsplash.com/photo-1496747611176-843222e1e57c?q=80&w=600"
        ];

        window.onload = () => {
            loadUser();
            initGallery();
            initStyles();
        };

        function showMessage(text) {
            const box = document.getElementById('msgBox');
            box.innerText = text;
            box.style.display = 'block';
            setTimeout(() => { box.style.display = 'none'; }, 3000);
        }

        function loadUser() {
            const saved = localStorage.getItem('ps_user_v3');
            if (saved) {
                currentUser = JSON.parse(saved);
                updateUI();
            } else {
                toggleSetupModal(true);
            }
        }

        function updateUI() {
            document.getElementById('navPic').src = currentUser.pic;
            document.getElementById('canvasName').innerText = currentUser.name;
            document.getElementById('canvasBio').innerText = currentUser.bio;
            document.getElementById('canvasAvatar').src = currentUser.pic;
            document.getElementById('domainTag').innerText = window.location.hostname.split('.')[0].toUpperCase() || 'STUDIO';
        }

        function toggleSetupModal(show) {
            document.getElementById('setupModal').classList.toggle('hidden', !show);
            if(show) {
                document.getElementById('setupName').value = currentUser.name;
                document.getElementById('setupBio').value = currentUser.bio;
                document.getElementById('setupPreview').src = currentUser.pic;
            }
        }

        document.getElementById('setupFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('setupPreview').src = ev.target.result;
                    currentUser.pic = ev.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function saveInitialSetup() {
            const name = document.getElementById('setupName').value;
            if (!name) return showMessage("Naam likhein!");
            currentUser.name = name;
            currentUser.bio = document.getElementById('setupBio').value;
            localStorage.setItem('ps_user_v3', JSON.stringify(currentUser));
            updateUI();
            toggleSetupModal(false);
        }

        function initGallery() {
            const container = document.getElementById('masonryContainer');
            demoImages.forEach(url => {
                const div = document.createElement('div');
                div.className = 'masonry-item opacity-0 animate-fade-in';
                div.innerHTML = `
                    <div class="relative group cursor-pointer overflow-hidden rounded-3xl bg-slate-800" onclick="openEditor('${url}')">
                        <img src="${url}" class="w-full h-auto object-cover opacity-80 group-hover:opacity-100 transition-opacity">
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function initStyles() {
            const container = document.getElementById('bgSelectors');
            premiumGradients.forEach(grad => {
                const btn = document.createElement('button');
                btn.className = 'w-12 h-12 rounded-xl border-2 border-white/20 shrink-0';
                btn.style.background = grad.style;
                btn.onclick = () => document.getElementById('canvasProfileOverlay').style.background = grad.style;
                container.appendChild(btn);
            });
        }

        function openEditor(imgUrl) {
            document.getElementById('canvasMainImage').src = imgUrl;
            document.getElementById('editorModal').classList.remove('hidden');
            document.getElementById('dragContainer').innerHTML = '';
            showPanel('Text');
        }

        function closeEditor() {
            document.getElementById('editorModal').classList.add('hidden');
        }

        function showPanel(panelName) {
            document.getElementById('activeToolPanel').classList.remove('hidden');
            document.querySelectorAll('.tool-panel').forEach(p => p.classList.add('hidden'));
            document.getElementById('panel' + panelName).classList.remove('hidden');
            
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.replace('text-white', 'text-white/40'));
            const activeBtn = Array.from(document.querySelectorAll('.tool-btn')).find(b => b.innerText.includes(panelName.toUpperCase()));
            if(activeBtn) activeBtn.classList.replace('text-white/40', 'text-white');
        }

        function setTheme(align) {
            const overlay = document.getElementById('canvasProfileOverlay');
            overlay.className = "absolute bottom-0 left-0 right-0 z-30 p-6 flex profile-overlay-gradient backdrop-blur-[2px]";
            if (align === 'left') overlay.classList.add('flex-row', 'items-end', 'text-left');
            else if (align === 'center') overlay.classList.add('flex-col', 'items-center', 'text-center');
            else if (align === 'right') overlay.classList.add('flex-row-reverse', 'items-end', 'text-right');
        }

        function setShape(shape) {
            document.getElementById('canvasAvatar').className = `w-16 h-16 object-cover border-2 border-white/50 shadow-lg ${shape}`;
        }

        function addNewText() {
            const val = document.getElementById('textInput').value.trim();
            if (!val) return;
            const el = document.createElement('div');
            el.className = 'draggable-element text-white drop-shadow-xl font-bold';
            el.innerText = val;
            el.style.fontSize = '28px';
            el.style.top = '20%'; el.style.left = '10%';
            el.onmousedown = (e) => { e.stopPropagation(); selectText(el); };
            el.ontouchstart = (e) => { e.stopPropagation(); selectText(el); };
            makeDraggable(el);
            document.getElementById('dragContainer').appendChild(el);
            document.getElementById('textInput').value = '';
            selectText(el);
        }

        function selectText(el) {
            deselectAll();
            selectedElement = el;
            el.classList.add('selected');
            document.getElementById('textEditPanel').classList.remove('hidden');
            document.getElementById('fontSelect').value = el.style.fontFamily || "'Outfit', sans-serif";
            document.getElementById('sizeRange').value = parseInt(el.style.fontSize);
            document.getElementById('colorPicker').value = rgbToHex(el.style.color);
        }

        function deselectAll() {
            document.querySelectorAll('.draggable-element').forEach(el => el.classList.remove('selected'));
            selectedElement = null;
            document.getElementById('textEditPanel').classList.add('hidden');
        }

        function updateTextStyling() {
            if(!selectedElement) return;
            selectedElement.style.fontFamily = document.getElementById('fontSelect').value;
            selectedElement.style.fontSize = document.getElementById('sizeRange').value + 'px';
            selectedElement.style.color = document.getElementById('colorPicker').value;
        }

        function deleteSelectedText() {
            if(selectedElement) { selectedElement.remove(); deselectAll(); }
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb.startsWith('#')) return rgb || '#ffffff';
            const parts = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            if (!parts) return '#ffffff';
            const hex = x => parseInt(x).toString(16).padStart(2, '0');
            return "#" + hex(parts[1]) + hex(parts[2]) + hex(parts[3]);
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = (e) => { p3 = e.clientX; p4 = e.clientY; document.onmousemove = drag; document.onmouseup = stop; };
            el.ontouchstart = (e) => { p3 = e.touches[0].clientX; p4 = e.touches[0].clientY; document.ontouchmove = dragT; document.ontouchend = stop; };
            function drag(e) { p1 = p3 - e.clientX; p2 = p4 - e.clientY; p3 = e.clientX; p4 = e.clientY; el.style.top = (el.offsetTop - p2) + "px"; el.style.left = (el.offsetLeft - p1) + "px"; }
            function dragT(e) { e.preventDefault(); const t = e.touches[0]; p1 = p3 - t.clientX; p2 = p4 - t.clientY; p3 = t.clientX; p4 = t.clientY; el.style.top = (el.offsetTop - p2) + "px"; el.style.left = (el.offsetLeft - p1) + "px"; }
            function stop() { document.onmousemove = null; document.ontouchmove = null; }
        }

        async function downloadPoster(scale) {
            deselectAll();
            const btn = event.currentTarget;
            btn.innerHTML = '<i class="fas fa-spinner animate-spin"></i>';
            try {
                const canvas = await html2canvas(document.getElementById('captureArea'), { scale: scale, useCORS: true, scrollY: -window.scrollY });
                const link = document.createElement('a');
                link.download = `poster-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                showMessage("Poster Save Ho Gaya!");
            } catch(e) { showMessage("Error!"); }
            btn.innerHTML = scale > 2 ? '<i class="fas fa-crown"></i> HD' : '<i class="fas fa-download"></i> SD';
        }

        async function sharePoster() {
            try {
                const canvas = await html2canvas(document.getElementById('captureArea'), { scale: 2, useCORS: true });
                canvas.toBlob(async blob => {
                    const file = new File([blob], 'poster.png', { type: 'image/png' });
                    if (navigator.share) await navigator.share({ files: [file] });
                    else showMessage("Sharing not supported");
                });
            } catch(e) { showMessage("Error!"); }
        }
    </script>
</body>
</html>
